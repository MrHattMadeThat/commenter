<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Card Comment Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 1em;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .outcome-card {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .outcome-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .outcome-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .outcome-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .outcome-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
        }

        .outcome-title {
            font-weight: 700;
            font-size: 1.2em;
            color: #333;
            flex: 1;
        }

        .level-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .level-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .level-btn:hover {
            border-color: #667eea;
        }

        .level-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .level-btn.level-2 {
            color: #f59e0b;
        }

        .level-btn.level-2.active {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .level-btn.level-3 {
            color: #10b981;
        }

        .level-btn.level-3.active {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .level-btn.level-3plus {
            color: #8b5cf6;
        }

        .level-btn.level-3plus.active {
            background: #8b5cf6;
            border-color: #8b5cf6;
            color: white;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .output-area {
            position: relative;
        }

        .char-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .char-counter.warning {
            background: #f59e0b;
        }

        .char-counter.error {
            background: #ef4444;
        }

        textarea#outputComment {
            min-height: 200px;
            padding-top: 50px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .editor-outcome {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .editor-outcome-title {
            font-weight: 700;
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
        }

        .template-editor {
            margin-bottom: 15px;
        }

        .template-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }

        textarea.template-input {
            min-height: 80px;
            font-size: 0.95em;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #e0f2fe;
            border-left: 4px solid #0284c7;
            color: #075985;
        }

        .alert-success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            color: #065f46;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }

        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Report Card Comment Builder</h1>
            <p>Generate professional, concise report card comments in seconds</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="builder">Comment Builder</button>
            <button class="tab" data-tab="editor">Template Editor</button>
        </div>

        <div class="content">
            <!-- BUILDER PANEL -->
            <div id="builderPanel" class="panel active">
                <div class="grid-2">
                    <div>
                        <div class="section">
                            <h2 class="section-title">Student Information</h2>
                            <div class="input-group">
                                <label for="studentName">Student Name</label>
                                <input type="text" id="studentName" placeholder="Enter student's first name">
                            </div>
                            <div class="input-group">
                                <label for="pronouns">Pronouns</label>
                                <select id="pronouns">
                                    <option value="they">they/them</option>
                                    <option value="she">she/her</option>
                                    <option value="he">he/him</option>
                                </select>
                            </div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">Select Outcomes</h2>
                            <div id="outcomesList"></div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">Optional Ending</h2>
                            <div class="input-group">
                                <label for="endingSelect">Add a closing comment (optional)</label>
                                <select id="endingSelect">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>

                        <button class="btn btn-primary" onclick="generateComment()" style="width: 100%;">
                            üöÄ Generate Comment
                        </button>
                    </div>

                    <div>
                        <div class="section">
                            <h2 class="section-title">Generated Comment</h2>
                            <div class="output-area">
                                <span class="char-counter" id="charCounter">0/700</span>
                                <textarea id="outputComment" placeholder="Your generated comment will appear here..."></textarea>
                            </div>
                            <div class="button-group">
                                <button class="btn btn-success" onclick="copyToClipboard()">
                                    üìã Copy to Clipboard
                                </button>
                                <button class="btn btn-secondary" onclick="clearAll()">
                                    üóëÔ∏è Clear All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EDITOR PANEL -->
            <div id="editorPanel" class="panel">
                <div class="alert alert-info">
                    <strong>Template Editor</strong><br>
                    Edit comment templates, add new outcomes, or reset to defaults. Changes are saved automatically to your browser.
                </div>

                <div class="section">
                    <h2 class="section-title">Manage Templates</h2>
                    <div class="button-group" style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="saveTemplates()">
                            üíæ Save Changes
                        </button>
                        <button class="btn btn-secondary" onclick="resetToDefaults()">
                            üîÑ Reset to Defaults
                        </button>
                    </div>
                    <div id="templateEditor"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Default database structure
        const defaultDatabase = {
            outcomes: {
                placeValue: {
                    title: "Place Value to the Millions",
                    templates: {
                        "2": "{Name} is developing confidence with place value to the millions. {They} can identify most place values with support but need reminders to read large numbers accurately.",
                        "3": "{Name} demonstrates solid understanding of place value to the millions and reads, writes, and compares large numbers with good accuracy.",
                        "3plus": "{Name} shows strong mastery of place value to the millions and confidently reads, writes, and compares large numbers with consistent accuracy."
                    }
                },
                decimals: {
                    title: "Adding & Subtracting Decimals to Thousandths",
                    templates: {
                        "2": "{Name} is working on adding and subtracting decimals accurately. {They} understand lining up the place values but still need support with consistency.",
                        "3": "{Name} adds and subtracts decimals to the thousandths with solid accuracy and lines up place values correctly in most situations.",
                        "3plus": "{Name} consistently adds and subtracts decimals to the thousandths with accuracy and clear reasoning."
                    }
                },
                standardForm: {
                    title: "Standard / Expanded / Word Form",
                    templates: {
                        "2": "{Name} is learning to convert numbers between standard, expanded, and word form, but still needs reminders to include all place values.",
                        "3": "{Name} converts numbers accurately between standard, expanded, and word form and demonstrates a good understanding of how place value is represented.",
                        "3plus": "{Name} confidently converts numbers between all forms with precision and uses place value language effectively."
                    }
                },
                primeFactorCombo: {
                    title: "Prime/Composite + Factor Trees",
                    templates: {
                        "2": "{Name} is developing understanding of prime and composite numbers and needs support to build accurate factor trees.",
                        "3": "{Name} identifies prime and composite numbers accurately and builds factor trees with growing independence.",
                        "3plus": "{Name} shows strong understanding of prime/composite numbers and creates clear, accurate factor trees consistently."
                    }
                }
            },
            endingOptions: [
                "They have strong foundational skills and could excel with increased focus.",
                "They consistently engage with lessons and contribute to class discussions.",
                "They benefit from checking their work and taking time with multi-step tasks.",
                "They are a curious learner who approaches math with confidence."
            ]
        };

        // Load or initialize database
        let database = JSON.parse(localStorage.getItem('commentDatabase')) || defaultDatabase;

        // Save database to localStorage
        function saveDatabase() {
            localStorage.setItem('commentDatabase', JSON.stringify(database));
        }

        // Initialize the app
        function init() {
            renderOutcomes();
            renderEndingOptions();
            renderTemplateEditor();
            setupTabs();
            updateCharCounter();
        }

        // Tab switching
        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active panel
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    document.getElementById(tabName + 'Panel').classList.add('active');
                });
            });
        }

        // Render outcomes in builder
        function renderOutcomes() {
            const container = document.getElementById('outcomesList');
            container.innerHTML = '';

            Object.keys(database.outcomes).forEach(key => {
                const outcome = database.outcomes[key];
                const card = document.createElement('div');
                card.className = 'outcome-card';
                card.id = 'outcome-' + key;
                
                card.innerHTML = `
                    <div class="outcome-header">
                        <input type="checkbox" class="outcome-checkbox" id="check-${key}" 
                               onchange="toggleOutcome('${key}')">
                        <div class="outcome-title">${outcome.title}</div>
                    </div>
                    <div class="level-selector" id="levels-${key}" style="display: none;">
                        <button class="level-btn level-2" onclick="selectLevel('${key}', '2')">
                            Level 2<br><small>Approaching</small>
                        </button>
                        <button class="level-btn level-3" onclick="selectLevel('${key}', '3')">
                            Level 3<br><small>Meeting</small>
                        </button>
                        <button class="level-btn level-3plus" onclick="selectLevel('${key}', '3plus')">
                            Level 3+<br><small>Strong</small>
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Render ending options
        function renderEndingOptions() {
            const select = document.getElementById('endingSelect');
            select.innerHTML = '<option value="">None</option>';
            
            database.endingOptions.forEach((option, index) => {
                const opt = document.createElement('option');
                opt.value = index;
                opt.textContent = option.substring(0, 50) + '...';
                select.appendChild(opt);
            });
        }

        // Toggle outcome selection
        function toggleOutcome(key) {
            const checkbox = document.getElementById('check-' + key);
            const levelsDiv = document.getElementById('levels-' + key);
            const card = document.getElementById('outcome-' + key);
            
            if (checkbox.checked) {
                levelsDiv.style.display = 'flex';
                card.classList.add('selected');
            } else {
                levelsDiv.style.display = 'none';
                card.classList.remove('selected');
                // Deselect all level buttons
                levelsDiv.querySelectorAll('.level-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        }

        // Select achievement level
        function selectLevel(key, level) {
            const levelsDiv = document.getElementById('levels-' + key);
            levelsDiv.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
        }

        // Get pronoun forms
        function getPronouns(baseForm) {
            const pronounMap = {
                'they': { they: 'they', them: 'them', their: 'their', They: 'They', Them: 'Them', Their: 'Their' },
                'she': { they: 'she', them: 'her', their: 'her', They: 'She', Them: 'Her', Their: 'Her' },
                'he': { they: 'he', them: 'him', their: 'his', They: 'He', Them: 'Him', Their: 'His' }
            };
            return pronounMap[baseForm];
        }

        // Generate comment
        function generateComment() {
            const studentName = document.getElementById('studentName').value.trim();
            const pronounBase = document.getElementById('pronouns').value;
            const endingIndex = document.getElementById('endingSelect').value;
            
            if (!studentName) {
                alert('Please enter a student name.');
                return;
            }

            const pronouns = getPronouns(pronounBase);
            let commentParts = [];

            // Collect selected outcomes
            Object.keys(database.outcomes).forEach(key => {
                const checkbox = document.getElementById('check-' + key);
                if (checkbox && checkbox.checked) {
                    const levelsDiv = document.getElementById('levels-' + key);
                    const activeBtn = levelsDiv.querySelector('.level-btn.active');
                    
                    if (activeBtn) {
                        const level = activeBtn.onclick.toString().match(/'(\d\w*)'/)[1];
                        let template = database.outcomes[key].templates[level];
                        
                        // Replace placeholders
                        template = template.replace(/\{Name\}/g, studentName);
                        template = template.replace(/\{They\}/g, pronouns.They);
                        template = template.replace(/\{they\}/g, pronouns.they);
                        template = template.replace(/\{Them\}/g, pronouns.Them);
                        template = template.replace(/\{them\}/g, pronouns.them);
                        template = template.replace(/\{Their\}/g, pronouns.Their);
                        template = template.replace(/\{their\}/g, pronouns.their);
                        
                        commentParts.push(template);
                    }
                }
            });

            if (commentParts.length === 0) {
                alert('Please select at least one outcome and achievement level.');
                return;
            }

            // Combine into paragraph
            let fullComment = commentParts.join(' ');

            // Add optional ending if selected and space allows
            if (endingIndex !== '') {
                const ending = database.endingOptions[parseInt(endingIndex)];
                const withEnding = fullComment + ' ' + ending;
                if (withEnding.length <= 700) {
                    fullComment = withEnding;
                }
            }

            // Update output
            document.getElementById('outputComment').value = fullComment;
            updateCharCounter();
        }

        // Update character counter
        function updateCharCounter() {
            const textarea = document.getElementById('outputComment');
            const counter = document.getElementById('charCounter');
            const count = textarea.value.length;
            
            counter.textContent = `${count}/700`;
            
            counter.classList.remove('warning', 'error');
            if (count > 700) {
                counter.classList.add('error');
            } else if (count > 650) {
                counter.classList.add('warning');
            }
        }

        // Copy to clipboard
        function copyToClipboard() {
            const textarea = document.getElementById('outputComment');
            if (!textarea.value) {
                alert('No comment to copy!');
                return;
            }
            
            textarea.select();
            document.execCommand('copy');
            
            alert('Comment copied to clipboard!');
        }

        // Clear all selections
        function clearAll() {
            document.getElementById('studentName').value = '';
            document.getElementById('pronouns').value = 'they';
            document.getElementById('endingSelect').value = '';
            document.getElementById('outputComment').value = '';
            
            document.querySelectorAll('.outcome-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            document.querySelectorAll('.outcome-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.querySelectorAll('.level-selector').forEach(div => {
                div.style.display = 'none';
            });
            
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            updateCharCounter();
        }

        // Render template editor
        function renderTemplateEditor() {
            const container = document.getElementById('templateEditor');
            container.innerHTML = '';

            Object.keys(database.outcomes).forEach(key => {
                const outcome = database.outcomes[key];
                const editorDiv = document.createElement('div');
                editorDiv.className = 'editor-outcome';
                
                let templatesHTML = '';
                Object.keys(outcome.templates).forEach(level => {
                    const levelName = level === '2' ? 'Level 2 (Approaching)' : 
                                     level === '3' ? 'Level 3 (Meeting)' : 
                                     'Level 3+ (Strong)';
                    templatesHTML += `
                        <div class="template-editor">
                            <label class="template-label">${levelName}</label>
                            <textarea class="template-input" data-outcome="${key}" data-level="${level}">${outcome.templates[level]}</textarea>
                        </div>
                    `;
                });
                
                editorDiv.innerHTML = `
                    <div class="editor-outcome-title">${outcome.title}</div>
                    ${templatesHTML}
                `;
                
                container.appendChild(editorDiv);
            });

            // Add ending options editor
            const endingsDiv = document.createElement('div');
            endingsDiv.className = 'editor-outcome';
            endingsDiv.innerHTML = '<div class="editor-outcome-title">Optional Ending Comments</div>';
            
            database.endingOptions.forEach((ending, index) => {
                const editorDiv = document.createElement('div');
                editorDiv.className = 'template-editor';
                editorDiv.innerHTML = `
                    <label class="template-label">Ending Option ${index + 1}</label>
                    <textarea class="template-input" data-ending="${index}">${ending}</textarea>
                `;
                endingsDiv.appendChild(editorDiv);
            });
            
            container.appendChild(endingsDiv);
        }

        // Save templates
        function saveTemplates() {
            // Update outcome templates
            document.querySelectorAll('textarea[data-outcome]').forEach(textarea => {
                const outcome = textarea.dataset.outcome;
                const level = textarea.dataset.level;
                database.outcomes[outcome].templates[level] = textarea.value;
            });

            // Update ending options
            document.querySelectorAll('textarea[data-ending]').forEach(textarea => {
                const index = parseInt(textarea.dataset.ending);
                database.endingOptions[index] = textarea.value;
            });

            saveDatabase();
            renderOutcomes();
            renderEndingOptions();
            
            alert('Templates saved successfully!');
        }

        // Reset to defaults
        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all templates to defaults? This cannot be undone.')) {
                database = JSON.parse(JSON.stringify(defaultDatabase));
                saveDatabase();
                renderOutcomes();
                renderEndingOptions();
                renderTemplateEditor();
                alert('Templates reset to defaults.');
            }
        }

        // Listen for textarea changes to update char counter
        document.addEventListener('DOMContentLoaded', () => {
            init();
            document.getElementById('outputComment').addEventListener('input', updateCharCounter);
        });
    </script>
</body>
</html>